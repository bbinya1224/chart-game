# 차트 매매 게임 명세서

## 1. 개요

- **총 50턴** 게임
- **초기자산**: 10,000,000원
- **핵심 메커닉**: 차트 확인 후 매수/매도 결정

## 2. 게임 플로우

- 턴 1~49: 차트 확인 → 매수/매도 선택 → "다음" 클릭
- 턴 50: 최종 보유 주식 자동 매도 → 결과 화면

## 3. 주요 기능

### Feature 1: 게임 상태 관리

- 현재 턴 (1~50)
- 보유 자산 (현금)
- 보유 주식 수
- 진입가격 (평단가)
- 거래 이력

### Feature 2: 차트 컴포넌트

- 과거 50개 캔들 데이터 표시
- 현재 턴 기준 봉우리까지만 표시
- 가격 범위 자동 조정

### Feature 3: 액션 버튼

- "매수": 현재가 기준 100주 매수 (보유 자산 검증)
- "매도": 현재 보유주식 전량 매도
- "다음": 턴 증가

### Feature 4: 손익 표시

- 보유주식 평가손익
- 실현손익 (이전 거래)
- 총 자산 = 현금 + 보유주식평가액

### Feature 5: 결과 화면

- 최종 자산
- 수익률
- 거래 이력 표시

## 4. 데이터 모델

\`\`\`typescript
type GameState = {
currentTurn: number;
cash: number;
shares: number;
entryPrice: number;
trades: Trade[];
currentPrice: number;
}

type Trade = {
turn: number;
type: 'buy' | 'sell';
price: number;
shares: number;
amount: number;
}
\`\`\`

## 5. 폴더 구조 (FSD)

\`\`\`
src/
├── app/
├── shared/
│ ├── types/gameTypes.ts
│ ├── hooks/useGameStore.ts
│ └── ui/ChartCanvas.tsx
├── features/
│ ├── game/
│ │ ├── model/gameSlice.ts
│ │ ├── ui/GameBoard.tsx
│ │ └── ui/ActionButtons.tsx
│ └── result/
│ └── ui/ResultScreen.tsx
└── pages/
├── game/page.tsx
└── result/page.tsx
\`\`\`

## 6. 게임 데이터 & 로직

### 6.1 차트 데이터

- **데이터 소스**: 고정 배열 (50개 캔들)
- **각 캔들 구조**:

```typescript
type Candle = {
  open: number;
  high: number;
  low: number;
  close: number;
  volume: number;
};
```

- **데이터 범위**: 10,000 ~ 15,000원 (변동성 있게)
- **초기가(turnIndex=0)**: 12,500원
- **현재가**: 현재 턴의 close 값

### 6.2 매수/매도 규칙

| 상황      | 액션               | 규칙                                                   |
| --------- | ------------------ | ------------------------------------------------------ |
| 매수      | 100주 구매         | 필요자금 = 현재가 × 100. 보유 현금 부족 시 버튼 비활성 |
| 매도      | 보유주식 전량 매도 | 보유주식 0이면 버튼 비활성                             |
| 이미 보유 | 추가매수 가능      | 평단가 자동 업데이트                                   |
| 턴 50     | 자동 매도          | 게임 끝나면서 현재 보유주식 전량 자동 매도             |

### 6.3 손익 계산

**평가손익** (보유 주식 있을 때):

```
평가손익 = (현재가 - 평단가) × 보유주식 수
```

**실현손익** (매도했을 때):

```
실현손익 = (매도가 - 매수평단가) × 매도량
```

**총 자산**:

```
총 자산 = 현금 + (현재가 × 보유주식 수) + 누적 실현손익
```

**수익률**:

```
수익률(%) = ((최종 자산 - 초기 자산) / 초기 자산) × 100
```

### 6.4 턴 진행

| 턴   | 상태    | 동작                                         |
| ---- | ------- | -------------------------------------------- |
| 1    | 초기    | "다음" 클릭 가능, 첫 차트만 보임             |
| 2~49 | 진행 중 | 매수/매도/다음 가능                          |
| 50   | 최종    | "다음" 클릭 → 보유주식 자동 매도 → 결과 화면 |

## 7. UI/UX 상세

### 7.1 게임 화면 레이아웃

```
┌─────────────────────────────────────┐
│ 턴: 15/50  |  현재가: 13,450원      │ ← 헤더
├─────────────────────────────────────┤
│                                     │
│          [차트 컴포넌트]             │ ← 차트 (400x300)
│       (과거~현재까지 캔들)           │
│                                     │
├─────────────────────────────────────┤
│ 💰 현금: 9,500,000원                 │
│ 📈 보유: 100주 @ 12,300원 (평단가)  │ ← 상태 정보
│ 📊 평가손익: +115,000원 (+0.84%)    │
├─────────────────────────────────────┤
│ [매수] [매도] [다음]                  │ ← 액션 버튼
└─────────────────────────────────────┘
```

### 7.2 헤더 정보

- 좌측: "턴: X/50"
- 중앙: "현재가: XX,XXX원"
- 우측: 실시간 총 자산 + 수익률

### 7.3 상태 정보 표시

```
💰 현금: 9,500,000원
📈 보유: 100주 @ 12,300원 (평단가)
📊 평가손익: +115,000원 (+0.84%)
   실현손익: -250,000원
━━━━━━━━━━━━━━━━━━━━━━
🎯 총 자산: 10,365,000원 (+3.65%)
```

### 7.4 버튼 상태

```typescript
// 매수 버튼
- 활성: 보유 현금 >= (현재가 × 100)
- 비활성: 현금 부족 시 → "자금 부족" 툴팁

// 매도 버튼
- 활성: 보유주식 > 0
- 비활성: 보유주식 = 0 → "매도할 주식 없음" 툴팁

// 다음 버튼
- 턴 1~49: 항상 활성
- 턴 50: "게임 종료" 텍스트로 변경
```

## 8. 결과 화면

```
┌─────────────────────────────────┐
│   🎮 게임 종료!                  │
├─────────────────────────────────┤
│ 초기 자산:     10,000,000원      │
│ 최종 자산:     11,250,000원      │
│ 수익:           +1,250,000원     │
│ 수익률:             +12.5%       │
├─────────────────────────────────┤
│ 📊 거래 이력                      │
│ ─────────────────────────────── │
│ 턴 5:  매수 100주 @ 12,500원     │
│ 턴 15: 매도 50주  @ 13,200원     │
│ 턴 23: 매수 100주 @ 12,800원     │
│ ...                             │
├─────────────────────────────────┤
│ [다시 하기] [홈으로]              │
└─────────────────────────────────┘
```

## 9. 엣지 케이스 & 에러 처리

| 상황              | 처리 방법                                  |
| ----------------- | ------------------------------------------ |
| 자금 부족         | 매수 버튼 비활성 + "자금 부족" 메시지      |
| 매도할 주식 없음  | 매도 버튼 비활성 + "보유 주식 없음" 메시지 |
| 마지막 턴에 매수  | 허용 (턴 50에서 자동 매도됨)               |
| 거래 없이 50턴 끝 | 초기 자산과 동일 자산으로 종료             |

## 10. 상태 관리 상세

```typescript
type GameStore = {
  // 기본 정보
  currentTurn: number;
  maxTurns: number;
  initialCash: number;
  candleData: Candle[];

  // 현재 포지션
  cash: number;
  shares: number;
  entryPrice: number;

  // 손익
  realizedProfit: number; // 실현손익 누적

  // 거래 이력
  trades: Trade[];

  // Actions
  buyShares: () => void;
  sellShares: () => void;
  nextTurn: () => void;
  resetGame: () => void;

  // Computed
  getCurrentPrice: () => number;
  getPositionValue: () => number;
  getTotalAssets: () => number;
  getProfitRate: () => number;
};
```

## 11. 개발 체크리스트

```markdown
### Phase 1: 초기화

- [ ] 프로젝트 폴더 구조 생성
- [ ] 의존성 설치 (zustand 등)
- [ ] tsconfig, eslint 설정

### Phase 2: 코어 로직

- [ ] types/gameTypes.ts 작성
- [ ] hooks/useGameStore.ts 구현
- [ ] 샘플 차트 데이터 생성

### Phase 3: UI 컴포넌트

- [ ] ChartCanvas 컴포넌트
- [ ] StatusInfo 컴포넌트 (자산, 손익)
- [ ] ActionButtons 컴포넌트
- [ ] GameBoard (통합)

### Phase 4: 페이지

- [ ] /game 페이지
- [ ] /result 페이지
- [ ] 네비게이션

### Phase 5: 마무리

- [ ] 반응형 디자인 확인
- [ ] 엣지 케이스 테스트
- [ ] 성능 최적화
```
